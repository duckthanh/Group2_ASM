# HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng TÃ­nh NÄƒng "PhÃ²ng Cá»§a TÃ´i"

## ğŸ“‹ Tá»•ng Quan

TÃ­nh nÄƒng "PhÃ²ng Cá»§a TÃ´i" cho phÃ©p ngÆ°á»i dÃ¹ng quáº£n lÃ½ táº¥t cáº£ cÃ¡c phÃ²ng trá» Ä‘Ã£ Ä‘áº·t vÃ  Ä‘ang thuÃª, theo dÃµi tráº¡ng thÃ¡i, thanh toÃ¡n, há»£p Ä‘á»“ng vÃ  nhiá»u hÆ¡n ná»¯a.

## ğŸš€ CÃ¡ch Truy Cáº­p

1. **ÄÄƒng nháº­p** vÃ o tÃ i khoáº£n cá»§a báº¡n
2. Nháº¥p vÃ o **avatar/tÃªn ngÆ°á»i dÃ¹ng** á»Ÿ gÃ³c pháº£i navbar
3. Chá»n **"PhÃ²ng cá»§a tÃ´i"** tá»« menu dropdown
4. Hoáº·c truy cáº­p trá»±c tiáº¿p: `/account/rooms`

## ğŸ“Š CÃ¡c Tráº¡ng ThÃ¡i PhÃ²ng

### 1. **Giá»¯ chá»— (HOLD)**
- Sau khi báº¥m "ThuÃª ngay" trÃªn trang chi tiáº¿t phÃ²ng
- Thá»i gian giá»¯ chá»—: 48 giá»
- **HÃ nh Ä‘á»™ng cáº§n lÃ m:**
  - Äáº·t cá»c trÆ°á»›c khi háº¿t háº¡n
  - Hoáº·c há»§y giá»¯ chá»— náº¿u khÃ´ng muá»‘n tiáº¿p tá»¥c

### 2. **ÄÃ£ Ä‘áº·t cá»c (DEPOSITED)**
- Sau khi thanh toÃ¡n tiá»n cá»c
- **HÃ nh Ä‘á»™ng cáº§n lÃ m:**
  - Chá» chá»§ trá» xÃ¡c nháº­n
  - KÃ½ há»£p Ä‘á»“ng Ä‘iá»‡n tá»­
  - Chá»n ngÃ y nháº­n phÃ²ng

### 3. **Äang thuÃª (ACTIVE)**
- ÄÃ£ kÃ½ há»£p Ä‘á»“ng vÃ  nháº­n phÃ²ng
- **Chá»©c nÄƒng cÃ³ sáºµn:**
  - Thanh toÃ¡n tiá»n nhÃ  hÃ ng thÃ¡ng
  - Xem lá»‹ch sá»­ thanh toÃ¡n
  - BÃ¡o cÃ¡o sá»± cá»‘
  - Gia háº¡n há»£p Ä‘á»“ng
  - LiÃªn há»‡ chá»§ trá»

### 4. **ÄÃ£ tráº£ phÃ²ng (ENDED)**
- Há»£p Ä‘á»“ng Ä‘Ã£ káº¿t thÃºc
- Xem lá»‹ch sá»­ thuÃª trá»
- Viáº¿t Ä‘Ã¡nh giÃ¡ cho phÃ²ng

### 5. **ÄÃ£ há»§y (CANCELED)**
- Äáº·t phÃ²ng bá»‹ há»§y
- Xem lÃ½ do há»§y (ngÆ°á»i dÃ¹ng/chá»§ trá»/há»‡ thá»‘ng)

## ğŸ¯ CÃ¡c TÃ­nh NÄƒng ChÃ­nh

### ğŸ” TÃ¬m kiáº¿m & Lá»c
- TÃ¬m theo tÃªn phÃ²ng, Ä‘á»‹a chá»‰
- Lá»c theo tráº¡ng thÃ¡i (tabs)
- Äáº¿m sá»‘ lÆ°á»£ng phÃ²ng theo tráº¡ng thÃ¡i

### ğŸ“‡ ThÃ´ng tin trÃªn má»—i Card
- áº¢nh phÃ²ng + badge tráº¡ng thÃ¡i
- Countdown (giá»¯ chá»— hoáº·c háº¿t háº¡n há»£p Ä‘á»“ng)
- TÃªn phÃ²ng, Ä‘á»‹a chá»‰
- GiÃ¡/thÃ¡ng, diá»‡n tÃ­ch, sá»©c chá»©a
- Progress bar (theo tráº¡ng thÃ¡i)
- ThÃ´ng tin chá»§ trá»
- CTA button (thay Ä‘á»•i theo tráº¡ng thÃ¡i)

### ğŸ“± Menu HÃ nh Äá»™ng (â‹®)
- Xem chi tiáº¿t
- Táº£i há»£p Ä‘á»“ng (náº¿u cÃ³)
- Táº£i biÃªn lai
- BÃ¡o sá»± cá»‘ (khi Ä‘ang thuÃª)
- LiÃªn há»‡ chá»§ trá»
- Há»§y giá»¯ chá»—/Ä‘áº·t cá»c

## ğŸ“„ Trang Chi Tiáº¿t PhÃ²ng

### ThÃ´ng tin hiá»ƒn thá»‹:
1. **Overview**
   - ThÃ´ng tin Ä‘áº·t phÃ²ng
   - ThÃ´ng tin Ä‘áº·t cá»c
   - ThÃ´ng tin há»£p Ä‘á»“ng (lease)

2. **Timeline**
   - Lá»‹ch sá»­ cÃ¡c sá»± kiá»‡n:
     - Táº¡o Ä‘áº·t chá»—
     - Äáº·t cá»c
     - KÃ½ há»£p Ä‘á»“ng
     - Nháº­n phÃ²ng
     - Káº¿t thÃºc há»£p Ä‘á»“ng

3. **Thanh toÃ¡n**
   - Báº£ng danh sÃ¡ch thanh toÃ¡n
   - ThÃ¡ng, sá»‘ tiá»n, tráº¡ng thÃ¡i
   - Link táº£i biÃªn lai

4. **TÃ i liá»‡u**
   - CMND/CCCD
   - Há»£p Ä‘á»“ng
   - CÃ¡c giáº¥y tá» khÃ¡c
   - Tráº¡ng thÃ¡i duyá»‡t

5. **Sá»± cá»‘**
   - Danh sÃ¡ch sá»± cá»‘ Ä‘Ã£ bÃ¡o
   - NÃºt "BÃ¡o cÃ¡o sá»± cá»‘ má»›i"
   - Form: TiÃªu Ä‘á», MÃ´ táº£, áº¢nh

### Sidebar HÃ nh Äá»™ng:
- **ThÃ´ng tin chá»§ trá»**: TÃªn, SÄT, Email
- **CÃ¡c nÃºt hÃ nh Ä‘á»™ng** (thay Ä‘á»•i theo tráº¡ng thÃ¡i):
  - Äáº·t cá»c ngay (HOLD)
  - Thanh toÃ¡n cá»c (DEPOSITED - chÆ°a thanh toÃ¡n)
  - KÃ½ há»£p Ä‘á»“ng (DEPOSITED - Ä‘Ã£ thanh toÃ¡n)
  - Thanh toÃ¡n tiá»n nhÃ  (ACTIVE)
  - Gia háº¡n há»£p Ä‘á»“ng (ACTIVE)
  - BÃ¡o sá»± cá»‘ (ACTIVE)
  - Há»§y giá»¯ chá»—/Ä‘áº·t phÃ²ng

## ğŸ”” ThÃ´ng BÃ¡o & Nháº¯c Viá»‡c

### Banner cáº£nh bÃ¡o hiá»ƒn thá»‹ khi:
- Sáº¯p háº¿t háº¡n giá»¯ chá»— (< 12h)
- ChÆ°a thanh toÃ¡n tiá»n cá»c
- Sáº¯p háº¿t háº¡n há»£p Ä‘á»“ng
- Tiá»n nhÃ  Ä‘áº¿n háº¡n

## ğŸ¨ Giao Diá»‡n

### MÃ u sáº¯c theo tráº¡ng thÃ¡i:
- **Giá»¯ chá»—**: Amber/Yellow
- **ÄÃ£ Ä‘áº·t cá»c**: Blue
- **Äang thuÃª**: Green
- **ÄÃ£ tráº£ phÃ²ng**: Gray
- **ÄÃ£ há»§y**: Red

### Responsive:
- Desktop: Grid 3-4 cá»™t
- Tablet: Grid 2 cá»™t
- Mobile: 1 cá»™t, tabs dáº¡ng carousel

## ğŸ“ Luá»“ng Sá»­ Dá»¥ng CÆ¡ Báº£n

### Luá»“ng 1: ThuÃª Ngay (KhÃ´ng Ä‘áº·t cá»c)
1. Trang chi tiáº¿t phÃ²ng â†’ "ThuÃª ngay"
2. Äiá»n form thÃ´ng tin
3. Táº¡o booking vá»›i status = HOLD
4. VÃ o "PhÃ²ng Cá»§a TÃ´i" â†’ Tháº¥y card vá»›i status "Giá»¯ chá»—"
5. Click "Äáº·t cá»c ngay" â†’ Thanh toÃ¡n
6. Status chuyá»ƒn sang DEPOSITED
7. KÃ½ há»£p Ä‘á»“ng
8. Status chuyá»ƒn sang ACTIVE
9. Nháº­n phÃ²ng vÃ  báº¯t Ä‘áº§u thuÃª

### Luá»“ng 2: Äáº·t Cá»c TrÆ°á»›c
1. Trang chi tiáº¿t phÃ²ng â†’ "Äáº·t cá»c"
2. Äiá»n form + sá»‘ tiá»n cá»c
3. Táº¡o booking vá»›i status = DEPOSITED
4. Thanh toÃ¡n tiá»n cá»c
5. KÃ½ há»£p Ä‘á»“ng
6. Status chuyá»ƒn sang ACTIVE

### Luá»“ng 3: Äang ThuÃª
1. Má»—i thÃ¡ng nháº­n thÃ´ng bÃ¡o thanh toÃ¡n
2. VÃ o "PhÃ²ng Cá»§a TÃ´i" â†’ Click "Thanh toÃ¡n tiá»n nhÃ "
3. Thanh toÃ¡n vÃ  lÆ°u biÃªn lai
4. CÃ³ sá»± cá»‘ â†’ "BÃ¡o sá»± cá»‘" â†’ Form + áº¢nh
5. Háº¿t háº¡n â†’ "Gia háº¡n há»£p Ä‘á»“ng" hoáº·c "Tráº£ phÃ²ng"

## ğŸ”§ API Endpoints

### Backend (Spring Boot)
```
GET    /api/me/rooms                          - Láº¥y danh sÃ¡ch phÃ²ng
GET    /api/me/rooms?status=HOLD              - Lá»c theo tráº¡ng thÃ¡i
GET    /api/me/rooms?q=keyword                - TÃ¬m kiáº¿m
GET    /api/me/rooms/{bookingId}              - Chi tiáº¿t phÃ²ng
POST   /api/me/rooms                          - Táº¡o booking má»›i
POST   /api/me/rooms/{bookingId}/payments     - Thanh toÃ¡n
GET    /api/me/rooms/{bookingId}/payments     - Lá»‹ch sá»­ thanh toÃ¡n
POST   /api/me/rooms/{bookingId}/contract/sign - KÃ½ há»£p Ä‘á»“ng
POST   /api/me/rooms/{bookingId}/cancel       - Há»§y booking
POST   /api/me/rooms/{bookingId}/renew        - Gia háº¡n
POST   /api/me/rooms/{bookingId}/handover     - Tráº£ phÃ²ng
POST   /api/me/rooms/{bookingId}/issues       - BÃ¡o sá»± cá»‘
POST   /api/me/rooms/{bookingId}/documents    - Upload tÃ i liá»‡u
```

### Frontend (React)
```javascript
import { myRoomsAPI } from './services/api'

// Láº¥y danh sÃ¡ch
const rooms = await myRoomsAPI.getMyRooms('ACTIVE', 'keyword')

// Láº¥y chi tiáº¿t
const detail = await myRoomsAPI.getMyRoomDetail('BK-2025-00123')

// Táº¡o booking
const booking = await myRoomsAPI.createBooking({
  roomId: 123,
  action: 'HOLD',
  duration: 6,
  durationUnit: 'MONTH',
  ...
})

// Thanh toÃ¡n
await myRoomsAPI.makePayment('BK-2025-00123', {
  amount: 3500000,
  method: 'BANK_TRANSFER'
})

// KÃ½ há»£p Ä‘á»“ng
await myRoomsAPI.signContract('BK-2025-00123')

// Há»§y booking
await myRoomsAPI.cancelBooking('BK-2025-00123', 'LÃ½ do há»§y')

// Gia háº¡n
await myRoomsAPI.renewLease('BK-2025-00123', 6)

// BÃ¡o sá»± cá»‘
await myRoomsAPI.createIssue('BK-2025-00123', {
  title: 'Äiá»u hÃ²a há»ng',
  description: '...',
  photos: []
})
```

## ğŸ’¾ Database Schema

### Booking (ÄÃ£ cáº­p nháº­t)
```sql
- booking_id VARCHAR(50) UNIQUE
- hold_expires_at TIMESTAMP
- deposit_amount DOUBLE
- deposit_paid BOOLEAN
- deposit_receipt_url VARCHAR(500)
- lease_start DATE
- lease_end DATE
- contract_status VARCHAR(50)
- contract_pdf_url VARCHAR(500)
- cancel_reason TEXT
- canceled_by VARCHAR(50)
```

### Payment (Má»›i)
```sql
- id, booking_id
- month VARCHAR(7)
- amount DOUBLE
- status VARCHAR(50)
- receipt_url VARCHAR(500)
- payment_method VARCHAR(50)
- paid_at TIMESTAMP
- due_date TIMESTAMP
```

### Issue (Má»›i)
```sql
- id, booking_id
- title VARCHAR(255)
- description TEXT
- photos TEXT
- status VARCHAR(50)
- landlord_response TEXT
- resolved_at TIMESTAMP
```

### Document (Má»›i)
```sql
- id, booking_id
- document_type VARCHAR(50)
- document_url VARCHAR(500)
- file_name VARCHAR(255)
- status VARCHAR(50)
```

## ğŸ› ï¸ CÃ i Äáº·t & Cháº¡y

### Backend
1. Cháº¡y SQL script Ä‘á»ƒ update database:
```bash
mysql -u root -p your_database < SQL/update_bookings_for_my_rooms.sql
```

2. Build & Run Spring Boot:
```bash
mvn clean install
mvn spring-boot:run
```

### Frontend
1. Install dependencies:
```bash
cd frontend
npm install
```

2. Run development server:
```bash
npm run dev
```

3. Truy cáº­p: `http://localhost:5173`

## ğŸ› Troubleshooting

### Lá»—i khÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch phÃ²ng
- Kiá»ƒm tra JWT token cÃ³ há»£p lá»‡
- Kiá»ƒm tra X-User-Id header Ä‘Æ°á»£c gá»­i Ä‘Ãºng
- Xem console log Ä‘á»ƒ debug

### Lá»—i khÃ´ng thá»ƒ thanh toÃ¡n
- Kiá»ƒm tra tráº¡ng thÃ¡i phÃ²ng
- Kiá»ƒm tra sá»‘ tiá»n
- Kiá»ƒm tra backend logs

### Lá»—i khÃ´ng thá»ƒ kÃ½ há»£p Ä‘á»“ng
- Pháº£i thanh toÃ¡n cá»c trÆ°á»›c
- Tráº¡ng thÃ¡i pháº£i lÃ  DEPOSITED

## ğŸ“ LiÃªn Há»‡ Há»— Trá»£

Náº¿u gáº·p váº¥n Ä‘á», vui lÃ²ng liÃªn há»‡:
- Email: support@timtro.com
- Phone: 1900-xxxx
- Hoáº·c bÃ¡o cÃ¡o issue trÃªn GitHub

---

**ChÃºc báº¡n cÃ³ tráº£i nghiá»‡m tá»‘t vá»›i tÃ­nh nÄƒng "PhÃ²ng Cá»§a TÃ´i"! ğŸ **

